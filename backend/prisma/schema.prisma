// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


model User {
  id            String   @id @default(uuid())
  name          String
  age           Int
  emailId       String   @unique
  phone         String?
  address       String?
  pincode       String?
  password      String
  refreshToken  String?
  photo         String?

  sos           SOS[]
  crimeReport   CrimeReport[]
  favlist       Favlist[]
}

model Admin {
  id            String   @id
  name          String
  username      String   @unique
  password      String
  refreshToken  String

  sos           SOS[]
  adminSosRec   AdminSosRec[]
  crimeReports  CrimeReport[] @relation("AdminCrimeReports")
}

model SOS {
  sosid    String   @id @default(uuid())
  userid   String
  observer String
  status   String
  datetime DateTime

  user     User     @relation(fields: [userid], references: [id])
  admin    Admin    @relation(fields: [observer], references: [id])
  adminSosRec AdminSosRec[]
}

model Favlist {
  userid   String
  fullname String
  phone    String
  email    String?
  relation String

  user     User     @relation(fields: [userid], references: [id])

  @@id([userid, phone]) // Assuming phone is unique per user
}

model CrimeReport {
  id            String   @id @default(uuid())
  userid        String
  title         String
  description   String
  medialink     String?
  mediatype     String?
  observer      String?
  status        String
  crimetime     DateTime
  reporttime    DateTime

  user     User     @relation(fields: [userid], references: [id])
  admin    Admin?    @relation(fields: [observer], references: [id], name: "AdminCrimeReports")
}

model AdminSosRec {
  datetime DateTime
  adminid  String
  sosid    String

  admin    Admin    @relation(fields: [adminid], references: [id])
  sos      SOS      @relation(fields: [sosid], references: [sosid])

  @@id([adminid, sosid, datetime])
}
